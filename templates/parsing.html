<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Windows Artifacts Parser - Parsing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <div class="container mt-5">
      <h1 id="status-heading">Parsing in Progress</h1>
      <p id="status-lead" class="lead">The server is now parsing the selected directory. This process may take a few minutes.</p>
      <div id="progress-bar-container" class="progress">
        <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" aria-valuenow="100" aria-valuemin="0" aria-valuemax="100" style="width: 100%"></div>
      </div>
      <p id="status-message" class="mt-3">Please check the console for progress updates. This page will be updated to show the report when the process is complete.</p>
      <div id="report-link-container" class="d-none">
        <a href="" id="report-link" class="btn btn-success" target="_blank">View Report</a>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      const taskId = "{{ task_id }}";
      const statusHeading = document.getElementById('status-heading');
      const statusLead = document.getElementById('status-lead');
      const progressBarContainer = document.getElementById('progress-bar-container');
      const statusMessage = document.getElementById('status-message');
      const reportLinkContainer = document.getElementById('report-link-container');
      const reportLink = document.getElementById('report-link');

      function checkStatus() {
        fetch(`/status/${taskId}`)
          .then(response => response.json())
          .then(data => {
            if (data.status === 'completed') {
              statusHeading.textContent = 'Parsing Complete';
              statusLead.textContent = 'The artifact parsing and correlation is complete.';
              progressBarContainer.classList.add('d-none');
              statusMessage.classList.add('d-none');
              reportLink.href = `/reports/${data.report_path}`;
              reportLinkContainer.classList.remove('d-none');
              clearInterval(interval);
            } else if (data.status === 'failed') {
                statusHeading.textContent = 'Parsing Failed';
                statusLead.textContent = `An error occurred: ${data.error}`;
                progressBarContainer.classList.add('d-none');
                statusMessage.classList.add('d-none');
                clearInterval(interval);
            }
          });
      }

      const interval = setInterval(checkStatus, 2000); // Poll every 2 seconds
    </script>
  </body>
</html>

